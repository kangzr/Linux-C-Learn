状态机：

- 各状态类之间互相依赖很严重，耦合度很高，可复用性差
- 结构不灵活，可扩展性差，难以脚本化/可视化
- 无法应对复杂的AI需求

行为树：

- 树状结构
- 从根节点开始自顶向下执行，最终执行节点为对应行为
- 易脚本化/可视化
- 逻辑和状态数据低耦合，任何节点写好可复用节点
- 可迅速而便捷的组织复杂的行为决策
- 可配置，把工作交给designer

行为树缺点：

- 每一帧都从root开始，有可能访问到所有的节点，对状态机消耗更多的cpu





介入层容灾

逻辑层容灾

存储层容灾



#### 服务注册和发现

单点故障问题（SPOF, Single point of failure)。

当故障发生，部分服务器不可用，因此需要**服务发现（Service dicovery）能力**，为微服务架构的一个核心模块，准确说为服务管理，包括服务注册、发现、优雅上下线、统计等功能。

阿里巴巴内部的SOA服务化治理框架dubbo

- Provider：暴露服务的提供方
- Consumer：调用远程服务的服务消费方
- Registry：服务注册与发现的注册中心
- Monitor：统计服务的调用次数和调用时间的监控中心
- Container：服务运行容器

运行在容器上的RPC服务，Provider启动后注册到Registry，Consumer向Rgistry订阅相关服务来获取服务地址和收到服务变化的动态通知。

服务发现的类型：1. 客户端发现服务列表，Round Robin；2. 服务端安装路由选择器，负责负载均衡



#### Zookeeper

是一个分布式服务框架，Apache Hadoop的一个子项目，主要用来解决分布式应用中经常遇到的一些数据管理问题，如统一命名服务，状态同步服务，集群管理，分布式应用配置项的管理等。

例：部署多台服务器，配置需要统一，使用Zookeeper能在多台服务器间同步配置，避免手动修改

例：多台服务器需要协作完成某项任务，例如分布式编译，zk可以采用master-worker方式，协同这个服务器集群完成以向任务

zk的高可用采用群兽选举算法来实现。zk的数据结构类似linux文件系统，每个节点为znode，节点上应该保存协调数据或者元数据，而不是应用数据。















---



#### 基于Skynet的游戏服务器实现

[云风Blog](https://blog.codingnow.com/2015/04/skynet_mmo.html)

业务拆分：

如果数据相互独立，就应该独立的服务去处理；如果交互密切，就不要拆分它们；

尽量不让一个服务承担太多热数据的处理，而冷数据或不需要高频响应的数据处理则可以堆积一起。



































