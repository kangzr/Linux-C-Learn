####  Linux内核分为五部分：

1. 进程调度
2. 内存管理
3. 进程间通信
4. 虚拟文件系统
5. 网络接口



>  网络：协议、套接字、套接字缓冲区、网络设备接口



| 用户进程      | 操作系统中的一个进程(最高层)             |
| :------------ | :--------------------------------------- |
| 系统调用接口  | 应用程序通过系统调用来调用OS内核接口     |
| **Linux内核** | 负责管理磁盘文件、内存、启动、网络传输等 |
| 硬件          | 物理设备，例如CPU、内存、硬盘、网路硬件  |



#### Linux内核抽象结构

1. 进程调度(SCHED)： 控制进程对CPU的访问，由调度程序选择最值得运行的进程
2. 内存管理(MM)：允许多个进程安全地共享主内存区域，支持虚拟内存，即在计算机中运行的程序，其代码、数据和堆栈的总量可超过实际内存大小，OS只将当前使用的程序块保留在内存中，其余程序块保留在磁盘。
3. 虚拟文件系统(Virtual File System, VFS)：隐藏各种不同硬件实现细节，为所有设备提供统一接口
4. 网络接口(NET)：提供对各种网络标准协议的存取和各种网络硬件的支持。
5. 进程间通信(IPC)：支持进程间各种通信机制。

#### i386的寄存器

- 通用寄存器
- 段寄存器：CS、DS、SS、ES
- 状态和控制寄存器：标志寄存器(EFLAGS)、指令指针(EIP)和4个控制寄存器组成
  1. 指令指针寄存器和标志寄存器
  2. 控制寄存器(与分页机制密切相关)：CR0（分页保护模式/实模式）、CR1(未定义)、CR2(页故障线性地址寄存器，保存最后一次出现页故障的全32位线性地址)、CR3(页目录基址寄存器，保存页目录表的物理地址)
- 系统地址寄存器：用于引用在保护模式下所需要的表和段，给目前正在执行的任务（或进程）定义任务环境、地址空间和中断向量空间。
  1. 全局描述符表寄存器GDTR(Global Descriptor Table Register), 用于保存全局描述符表GDT的32位基地址和16位GDT的界限
  2. 中断描述符表寄存器IDTR(Interrupt Descriptor Table Register), 用于保存中断描述符表(IDT)的32位基地址和16位IDT的界限
  3. 局部描述表寄存器LDTR(Global Descriptor Table Register), 保存局部描述符表LDT段的选择符
  4. 任务状态寄存器TSR(Task State Register), 用于保存任务状态段TSS段的16位选择符
- 调试寄存器和测试寄存器
  1. 调试寄存器
  2. 测试寄存器

#### 内存地址

8086实模式：寄存器左移4位，与地址ADDR相加后送至内存总线，此地址为内存单元的物理地址，程序中此地址为逻辑地址(虚地址)

80386保护模式：逻辑地址不会直接送到内存总线，而是被送到内存管理单元MMU，MMU由一个或一组芯片组成，其功能是把逻辑地址映射位物理地址，即进行地址转换。

MMU是一种硬件电路，包含两个部件：

	1. 分段部件(分段机制)：逻辑地址(选择符+偏移量) ---> 线性地址
 	2. 分页部件(粉也机制)：线性地址 ---> 物理地址



- 逻辑地址：每个逻辑地址都由一个段和偏移量组成
- 线性地址：32位无符号整数
- 物理地址：内存单元的实际地址，用于芯片级内存单元寻址。也是32位无符号整数



#### 段机制和描述符

1. 段机制
2. 描述符
   - 概念
   - 系统段描述符
   - 描述符表
     - 全局描述符表GDT: 除任务门、中断门、陷阱门描述符外，包含系统中所有任务都共用的段描述符
     - 中断描述符表IDT：包含256个门描述符，只包含任务门，中断门，陷阱门。
     - 局部描述符表LDT：包含了与一个给定任务相关的描述符，每个任务各自一个LDT，可使给定任务的代码、数据和别的任务相隔离。
   - 选择符与描述符表寄存器



#### 分页机制

1. 分页机制
2. 页面高速缓存：(页面高速缓存命中率98%，只有2%几率会访问两级分页机构)

#### Linux分页机制

采用分页机制实现虚拟存储器管理

三种类型页表

1. 总目录PGD(Page Global Directory)
2. 中间目录PMD(Page Middle Directory)
3. 页表PT(Page Table)